package me.gamrboy4life.paradox.mods.impl;

import java.util.Collection;

import me.gamrboy4life.paradox.gui.hud.ScreenPosition;
import me.gamrboy4life.paradox.mods.ModDraggable;
import net.minecraft.client.resources.I18n;
import net.minecraft.potion.Potion;
import net.minecraft.potion.PotionEffect;

public class ModPotionEffects extends ModDraggable {

    private ScreenPosition pos;

    @Override
    public int getWidth() {
        return font.getStringWidth(getPotionEffectsString()); 
    }

    @Override
    public int getHeight() {
        return font.FONT_HEIGHT;
    }

    @Override
    public void render(ScreenPosition pos) {
        String potionEffectsString = getPotionEffectsString();
        font.drawString(potionEffectsString, pos.getAbsoluteX(), pos.getAbsoluteY(), -1);
    }

    private String getPotionEffectsString() {
        Collection<PotionEffect> effects = mc.thePlayer.getActivePotionEffects();
        StringBuilder effectsString = new StringBuilder();
        
        for (PotionEffect effect : effects) {
            Potion potion = Potion.getPotionFromResourceLocation(effect.getPotionID());
            String effectName = I18n.translateToLocal(potion.getName());
            int duration = effect.getDuration();
            int seconds = duration / 20; // Minecraft のティックは1秒あたり20ティック
            effectsString.append(String.format("%s: %d秒", effectName, seconds)).append("\n");
        }
        
        return effectsString.toString();
    }

    @Override
    public void renderDummy(ScreenPosition pos) {
        String potionEffectsString = getPotionEffectsString();
        font.drawString(potionEffectsString, pos.getAbsoluteX(), pos.getAbsoluteY(), -1);
    }

    @Override
    public boolean isEnabled() {
        return true;
    }

    @Override
    public void save(ScreenPosition pos) {
        this.pos = pos;
    }

    @Override
    public ScreenPosition load() {
        return pos;
    }

}